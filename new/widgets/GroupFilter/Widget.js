// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"widgets/GroupFilter/SaveJSON":function(){define("dojo/Evented dojo/_base/declare dojo/Deferred dojo/_base/html dojo/has jimu/utils".split(" "),function(y,x,v,t,w,n){return x([y],{declaredClass:"saveJSON",config:null,constructor:function(f){x.safeMixin(this,f)},_getDownloadUrl:function(f){return window.Blob&&window.URL&&window.URL.createObjectURL?(f=new Blob([f],{type:"text/json"}),URL.createObjectURL(f)):"data:attachment/json;charset\x3dutf-8,"+encodeURIComponent(f)},exportsJson:function(f,
m){m=JSON.stringify(m);var z=new v;try{if(w("ie")&&10>w("ie")){var u=window.top.open("about:blank","_blank");u.document.write("sep\x3d,\r\n"+m);u.document.close();u.document.execCommand("SaveAs",!0,f);u.close();this.savePrompt()}else if(10===w("ie")||this._isIE11()||this._isEdge()){var d=new Blob([m],{type:"text/json"});navigator.msSaveBlob(d,f);this.savePrompt()}else{var l=t.create("a",{href:this._getDownloadUrl(m),target:"_blank",download:f},document.body);if(w("safari")){var n=document.createEvent("MouseEvents");
n.initEvent("click",!0,!0);l.dispatchEvent(n)}else l.click();this.savePrompt();t.destroy(l)}z.resolve()}catch(g){z.reject(g)}return z},_isIE11:function(){return 11===n.has("ie")},_isEdge:function(){return n.has("edge")},savePrompt:function(){this.emit("complete",{})}})})},"widgets/GroupFilter/ReadJSON":function(){define("dojo/Evented dojo/_base/declare dojo/has dojo/_base/lang jimu/utils jimu/dijit/Message".split(" "),function(y,x,v,t,w,n){return x([y],{declaredClass:"readJSON",config:null,jsonFile:null,
constructor:function(f){x.safeMixin(this,f)},checkFileReader:function(){this.supportHTML5()?(console.log("HTML 5 loader"),this._processFiles(this.jsonFile)):this.supportHTML5()||v("safari")||!this.isEnabledFlash()?console.log("no loader"):w.file.loadFileAPI().then(t.hitch(this,function(){console.log("loading FileAPI")}))},_processFiles:function(f){0<f.length&&(f=f[0],-1!==f.name.indexOf(".json")?f&&this.handleJson(f):new n({message:"Not a json file"}))},handleJson:function(f){if(this.supportHTML5()){var m=
new FileReader;m.onload=function(f){return function(){-1<m.result.indexOf("groups")?f.completePrompt(m.result):(new n({message:"json file is Invalid"}),f.errorPrompt("error"))}}(this);m.readAsText(f)}else window.FileAPI.readAsText(f,t.hitch(this,function(m){}))},supportHTML5:function(){return window.File&&window.FileReader&&window.FileList&&window.Blob?!0:!1},supportFileAPI:function(){return v("safari")&&6>v("safari")?!1:window.FileAPI&&window.FileAPI.readAsDataURL?!0:!1},isEnabledFlash:function(){var f=
null;if(document.all)try{f=new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(m){f=null}else navigator.plugins&&0<navigator.plugins.length&&(f=navigator.plugins["Shockwave Flash"]);return!!f},completePrompt:function(f){this.emit("complete",{UserSettings:f})},errorPrompt:function(){this.emit("error",{UserSettings:"error"})}})})},"widgets/GroupFilter/LayersHandler":function(){define("dojo/Evented dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Deferred dojo/promise/all esri/request".split(" "),
function(y,x,v,t,w,n,f){return x([y],{declaredClass:"LayersHandler",layers:null,layerStore:[],fieldName:null,childList:null,validFieldTypes:"esriFieldTypeInteger esriFieldTypeSmallInteger esriFieldTypeDouble esriFieldTypeSingle esriFieldTypeString esriFieldTypeDate esriFieldTypeGeometry esriFieldTypeOID esriFieldTypeBlob esriFieldTypeGlobalID esriFieldTypeRaster esriFieldTypeGUID esriFieldTypeXML".split(" "),layersOnly:!1,constructor:function(m){x.safeMixin(this,m)},getAllMapLayers:function(){var m=
[],f=new w,u;this.layerStore=[];t.forEach(this.layers,v.hitch(this,function(d){if(!d.featureCollection)if("undefined"===typeof d.originOperLayer||!d.originOperLayer.layerType||"ArcGISFeatureLayer"!==d.originOperLayer.layerType&&"ArcGISImageServiceLayer"!==d.originOperLayer.layerType)if(0<d.newSubLayers.length){if(this.childList=[],"undefined"===typeof d.originOperLayer.layerType||"ArcGISTiledMapServiceLayer"!==d.originOperLayer.layerType&&"VectorTileLayer"!==d.originOperLayer.layerType)t.forEach(d.layerObject.layerInfos,
v.hitch(this,function(l){l={label:l.name,id:d.id+"."+l.id,url:d.originOperLayer.url+"/"+l.id,type:"Layer",fieldName:this.fieldName,checked:!1,children:[],layer:d.layerObject};this.childList.push(l);m.push(this._getLayerInfo(l))})),u={label:d.title,id:d.id,url:d.originOperLayer.url,type:"Service",checked:!1,children:this.childList,layer:d.layerObject},this.layerStore.push(u)}else("undefined"===typeof d.originOperLayer.layerType||"ArcGISTiledMapServiceLayer"!==d.originOperLayer.layerType&&"VectorTileLayer"!==
d.originOperLayer.layerType)&&"ArcGISMapServiceLayer"===d.originOperLayer.layerType&&(this.childList=[],t.forEach(d.layerObject.layerInfos,v.hitch(this,function(l){l={label:l.name,id:d.id+"."+l.id,url:d.originOperLayer.url+"/"+l.id,type:"Layer",fieldName:this.fieldName,checked:!1,children:[],layer:d.layerObject};this.childList.push(l);m.push(this._getLayerInfo(l))})),u={label:d.title,id:d.id,url:d.originOperLayer.url,type:"MapService",checked:!1,children:this.childList,layer:d.layerObject},this.layerStore.push(u));
else"undefined"===typeof d.originOperLayer.featureCollection&&(u={label:d.title,id:d.id,url:d.url,fieldName:this.fieldName,type:"Feature Layer",checked:!1,children:[],layer:d.layerObject},m.push(this._getLayerInfo(u)),this.layerStore.push(u))}));n(m).then(v.hitch(this,function(){var d=this._controlComplete();this.emit("complete",d);f.resolve(d)}),v.hitch(this,function(){f.resolve(null)}));return f.promise},_getLayerInfo:function(m){var n=new w;m.url?0===m.url.length?n.resolve():f({url:m.url,content:{f:"json"},
callbackParamName:"callback"}).then(v.hitch(this,function(f){if(f.hasOwnProperty("fields")&&!1===this.layersOnly){var d=t.map(f.fields,v.hitch(this,function(d){return{label:d.alias,id:m.id+"."+d.name,name:d.name,type:"Field",fieldType:d.type,checked:!1}})),d=t.filter(d,v.hitch(this,function(d){return 0<=t.indexOf(this.validFieldTypes,d.fieldType)}));m.children=d}m.geometryType=f.geometryType;m.visible=!0;this.geometryTypes&&!t.some(this.geometryTypes,function(d){if(d===m.geometryType)return!0})&&
(m.visible=!1);n.resolve(f)}),function(){n.resolve(null)}):n.resolve();return n.promise},_controlComplete:function(){t.forEach(this.layerStore,function(f){if(f.children&&0<f.children.length){var m=t.filter(f.children,function(f){return f.hasOwnProperty("visible")?f.visible:!0});f.children=m;0===f.children.length&&(f.visible=!1)}});return this.store={data:{identifier:"id",label:"label",items:t.filter(this.layerStore,function(f){return f.hasOwnProperty("visible")?f.visible:!0})}}}})})},"widgets/GroupFilter/_build-generate_module":function(){define(["dojo/text!./Widget.html",
"dojo/text!./css/style.css","dojo/i18n!./nls/strings"],function(){})},"url:widgets/GroupFilter/Widget.html":'\x3cdiv\x3e\r\n\t\x3cdiv class\x3d"groupContainer" data-dojo-attach-point\x3d"widgetIntro"\x3e\r\n\t\t\x3cdiv class\x3d"group-picker"\x3e\r\n\t\t\t\x3ctable width\x3d"100%" cellspacing\x3d"0" cellpadding\x3d"0"\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd class\x3d"groupHeader" data-dojo-attach-point\x3d"groupSelectHeader" \x3e${nls.labels.selectGroup}\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd class\x3d"saveIconHolder"\x3e\r\n            \x3cdiv class\x3d"saveTD" data-dojo-attach-point\x3d"optionsIcon" id\x3d"saveTD" tabIndex\x3d0 aria-label\x3d"${nls.labels.layerOptionHeading}" role\x3d"button"\x3e\x3c/div\x3e\r\n          \x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd colspan\x3d"2"\x3e\x3cdiv data-dojo-attach-point\x3d"groupPicker" id\x3d"groupPicker"\x3e\x3c/div\x3e\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd colspan\x3d"2" id\x3d"groupDesc" data-dojo-attach-point\x3d"groupDesc" style\x3d"padding-top: 5px"\x3e\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/table\x3e\r\n\t\t\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\r\n\t\x3cdiv class\x3d"container" data-dojo-attach-point\x3d"filterBlock" id\x3d"filterBlock"\x3e\r\n\t\t\x3cdiv class\x3d"filter-block" data-dojo-attach-point\x3d"filterBlockInner" id\x3d"filterBlockInner"\x3e\r\n\t\t\t\x3ctable id\x3d"tblPredicates" class\x3d"tableFormat" border\x3d0 cellspacing\x3d"0" cellpadding\x3d"0"\x3e\x3c/table\x3e\r\n\t\t\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\r\n\t\x3cdiv class\x3d"saveContainer" data-dojo-attach-point\x3d"saveBlock" id\x3d"saveBlock"\x3e\r\n\t\t\x3cdiv class\x3d"save-block" data-dojo-attach-point\x3d"saveBlockInner" id\x3d"saveBlockInner"\x3e\r\n\t\t\t\x3ctable id\x3d"tblSave" class\x3d"tableFormat" border\x3d0 cellspacing\x3d"0" cellpadding\x3d"0"\x3e\r\n\t\t\t\t\x3ctr class\x3d"rowHeader"\x3e\r\n\t\t\t\t\t\x3ctd\x3e\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd class\x3d"tdFirstLabel" aria-labelledby\x3d${nls.labels.saveHeading}\x3e${nls.labels.saveHeading}\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd class\x3d"close-save" data-dojo-attach-point\x3d"closeSaveIcon" tabIndex\x3d0 aria-label\x3d"${nls.buttons.save}" role\x3d"button"\x3e\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd class\x3d"tdData"\x3e\x3cdiv class\x3d"jimu-btn saveFunction" data-dojo-attach-point\x3d"btnSaveToJson" data-dojo-attach-event\x3d"click:saveJsonToFile" tabIndex\x3d0 role\x3d"button"\x3e${nls.buttons.save}\x3c/div\x3e\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr class\x3d"rowHeader"\x3e\r\n\t\t\t\t\t\x3ctd\x3e\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd class\x3d"tdLabel"\x3e${nls.labels.uploadHeading}\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr class\x3d"rowHeader"\x3e\r\n\t\t\t\t\t\x3ctd\x3e\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd class\x3d"tdData"\x3e\x3cinput type\x3d"file" id\x3d"jsonFileInput" data-dojo-attach-point\x3d"jsonFileInput" data-dojo-attach-event\x3d"change:readJsonToConfig" accept\x3d".json" aria-label\x3d"${nls.labels.uploadHeading}" role\x3d"button"\x3e\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd class\x3d"loadProgressHeader" id\x3d"tdProgress"\x3e\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/table\x3e\r\n\t\t\t\x3cbr\x3e\r\n\t\t\t\x3ctable id\x3d"tblFIlterOptions" class\x3d"tableFormat" border\x3d0 cellspacing\x3d"0" cellpadding\x3d"0"\x3e\r\n\t\t\t\t\x3ctr class\x3d"rowHeader"\x3e\r\n\t\t\t\t\t\x3ctd class\x3d"tdLabel"\x3e${nls.labels.layerOptionHeading}\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr style\x3d"height:0px; display:none;"\x3e\r\n\t\t\t\t\t\x3ctd class\x3d"tdData"\x3e\x3cinput type\x3d"checkbox" data-dojo-type\x3d"dijit/form/CheckBox"  data-dojo-attach-point\x3d"chkAppendToDef" data-dojo-props\x3d"value:true,checked:false"/\x3e ${nls.labels.AppendDefHeading}\r\n\t\t\t\t\t\t\x3cselect data-dojo-attach-point\x3d"slAppendChoice" data-dojo-type\x3d"dijit/form/Select"\x3e\r\n\t\t\t\t\t\t    \x3coption value\x3d"OR"\x3e${nls.inputs.optionOR}\x3c/option\x3e\r\n\t\t\t\t\t\t    \x3coption value\x3d"AND"\x3e${nls.inputs.optionAND}\x3c/option\x3e\r\n\t\t\t\t\t\t\x3c/select\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd class\x3d"tdData"\x3e\x3cinput type\x3d"checkbox" data-dojo-type\x3d"dijit/form/CheckBox"  data-dojo-attach-point\x3d"chkPersistDef" data-dojo-props\x3d"value:true,checked:false" aria-label\x3d"${nls.labels.PersistDefHeading}"/\x3e ${nls.labels.PersistDefHeading}\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr class\x3d"rowHeader"\x3e\r\n\t\t\t\t\t\x3ctd class\x3d"tdLabel"\x3e${nls.labels.RefreshHeading}\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd class\x3d"tdData"\x3e\x3cdiv data-dojo-attach-point\x3d"refreshDataIcon" data-dojo-attach-event\x3d"click:refreshData" tabIndex\x3d0\x3e\x3ca class\x3d"refresh-icon" id\x3d"refreshDiv" role\x3d"button"\x3e\x3c/a\x3e ${nls.labels.RefreshValueList}\x3c/div\x3e\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/table\x3e\r\n\t\t\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\r\n\r\n\t\x3cdiv class\x3d"buttonContainer"\x3e\r\n\t\t\x3ctable class\x3d"buttonContainerTable" border\x3d0\x3e\r\n\t\t\t\x3ctr\x3e\r\n          \x3ctd class\x3d"filter-add-criteria" width\x3d"100%"\x3e\x3cdiv class\x3d"jimu-btn" data-dojo-attach-point\x3d"btnCriteria" data-dojo-attach-event\x3d"click:btnNewRowAction" tabIndex\x3d"0"\x3e${nls.buttons.addCriteria}\x3c/div\x3e\x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr\x3e\r\n        \x3ctd width\x3d"100%"\x3e\r\n\t\t\t\t\t\x3ctable class\x3d"buttonContainerSubtable" border\x3d0 width\x3d"100%"\x3e\r\n\t\t\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\t\t\x3ctd class\x3d"filter-button-apply" width\x3d"50%"\x3e\x3cdiv class\x3d"jimu-btn" data-dojo-attach-point\x3d"btnApply" data-dojo-attach-event\x3d"click:setFilterLayerDef" tabIndex\x3d"0"\x3e${nls.buttons.applyCriteria}\x3c/div\x3e\x3c/td\x3e\r\n\t\t\t\t\t\t\t\x3ctd class\x3d"filter-button-cancel"  width\x3d"50%"\x3e\x3cdiv class\x3d"jimu-btn" data-dojo-attach-point\x3d"btnReset" data-dojo-attach-event\x3d"click:clearCriteria" tabIndex\x3d"0"\x3e${nls.buttons.removeCriteria}\x3c/div\x3e\x3c/td\x3e\r\n\t\t\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\t\x3c/table\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\x3c/tr\x3e\r\n\t\t\x3c/table\x3e\r\n\t\x3c/div\x3e\r\n\r\n\x3c/div\x3e',
"url:widgets/GroupFilter/css/style.css":'.jimu-widget-map-filter {width:100%; height:100%;}.jimu-widget-map-filter .groupContainer {display: block;}.jimu-widget-map-filter .container {border-color: #e1e1e1; border-top: 3px solid; width: 100%; display: block;}.jimu-widget-map-filter .saveContainer {width: 100%; height: 100%; position:absolute; top: 0px; left: 0px; overflow-y: auto; overflow-x: auto; display: none;}.jimu-widget-map-filter .save-block {position: absolute; left: 5px;}.jimu-widget-map-filter .close-save {position:relative; float: right; content: url("../images/setting_default.png"); cursor: hand; cursor: pointer;}.jimu-widget-map-filter .close-save:after {position:relative; float: right; content: url("../images/setting_default.png"); cursor: hand; cursor: pointer;}.jimu-widget-map-filter .headerTable {width: 100%;}.jimu-widget-map-filter .groupHeader {font-size: 10pt; padding-left: 0px; padding-bottom: 5px; width: 100%;}.jimu-widget-map-filter .saveIconHolder{vertical-align: top;}.jimu-widget-map-filter .saveTD {content: url("../images/setting_disabled.png"); cursor: hand; cursor: pointer;}.jimu-widget-map-filter .saveTD:after {content: url("../images/setting_disabled.png"); cursor: hand; cursor: pointer;}.jimu-widget-map-filter .saveTDClose {content: url("../images/setting_default.png"); cursor: hand; cursor: pointer;}.jimu-widget-map-filter .saveTDClose:after {content: url("../images/setting_default.png"); cursor: hand; cursor: pointer;}.jimu-widget-map-filter .group-picker {padding-bottom: 5px;}.jimu-widget-map-filter .filter-block {}.jimu-widget-map-filter .filter-row {position: relative; width: 100%;}.jimu-widget-map-filter .tableFormat {table-layout: fixed; width:100%;}.jimu-widget-map-filter .rowHeader {color: #000000;}.jimu-widget-map-filter .saveFunction {margin-top: 5px;}.jimu-widget-map-filter .tableRow {background-color: #E3E3E3;}.jimu-widget-map-filter .tdOperatorHide {display: block; width: 75px;}.jimu-widget-map-filter .operatorSelect {}.jimu-widget-map-filter .tdValue {width: 200px; height: 20px; padding-left: 5px;}.jimu-widget-map-filter .userInputNormal {width: 95%;}.jimu-widget-map-filter .tdConjunction {width: 75px;}.jimu-widget-map-filter .conjuncSelect {width: 70px;}.jimu-widget-map-filter .tdRemove {width: 16px; text-align: right;}.jimu-widget-map-filter .tdFirstLabel {text-align: left; padding-left: 5px; padding-top: 5px; padding-bottom: 0px; padding-right: 5px; width: 100%;}.jimu-widget-map-filter .tdLabel {text-align: left; padding-left: 5px; padding-top: 15px; padding-bottom: 2px; padding-right: 5px; width: 100%;}.jimu-widget-map-filter .tdData {text-align: left; padding-left: 5px; padding-top: 5px; padding-bottom: 5px; padding-right: 5px; width: 100%;}.jimu-widget-map-filter .tdUploadData {text-align: left; padding-left: 5px; padding-top: 10px; padding-bottom: 0px; padding-right: 5px; width: 100%;}.jimu-widget-map-filter .tdSave {text-align: right; padding-right: 5px; width: 100%;}.jimu-widget-map-filter .loadProgressHeader {display: none; width: 16px;}.jimu-widget-map-filter .loadProgressShow {content: url("../images/validating.gif"); display: none; width: 16px;}.jimu-widget-map-filter .loadProgressShow:after {content: url("../images/validating.gif"); display: none; width: 16px;}.jimu-widget-map-filter .advModeOffset {content: url("../images/setting_default.png"); padding-right: 10px; cursor: hand; cursor: pointer;}.jimu-widget-map-filter .advModeOffset:after {content: url("../images/setting_default.png"); padding-right: 10px; cursor: hand; cursor: pointer;}.jimu-widget-map-filter .advModeClose {content: url("../images/setting_disabled.png"); cursor: hand; cursor: pointer; width: 16px; height: 16px;}.jimu-widget-map-filter .advModeClose:after {content: url("../images/setting_disabled.png"); cursor: hand; cursor: pointer; width: 16px; height: 16px;}.jimu-widget-map-filter .advModeOpen {content: url(""); cursor: hand; cursor: pointer; width: 16px; height: 16px;}.jimu-widget-map-filter .deleteCell {content: url("../images/delete.png"); width: 16px; height: 16px; cursor: hand; cursor: pointer;}.jimu-widget-map-filter .deleteCell:after {content: url("../images/delete.png"); width: 16px; height: 16px; cursor: hand; cursor: pointer;}.jimu-widget-map-filter .deleteCell:hover {content: url("../images/delete_hover.png"); width: 16px; height: 16px; cursor: hand; cursor: pointer;}.jimu-widget-map-filter .buttonContainer {position: relative; bottom: 0px; width: 100%;}.jimu-widget-map-filter .buttonContainerTable {width: 100%;}.jimu-widget-map-filter .buttonContainerSubtable {float: left;}.jimu-widget-map-filter .filter-add-criteria {text-align: left;}.jimu-widget-map-filter .filter-button-apply {text-align: left; padding-right: 5px;}.jimu-widget-map-filter .filter-button-cancel {text-align: right;}.jimu-widget-map-filter .criteriaCellSize {width: 90%; vertical-align: top; padding-top: 5px; padding-left: 2px;}.jimu-widget-map-filter .deleteCellSize {width: 20px; text-align: right; vertical-align: top; padding-top: 5px;}.jimu-widget-map-filter .hide-items {display: none;}.jimu-widget-map-filter .refresh-icon:after {content: url("../images/refresh.png"); width: 16px; height: 16px; cursor: hand; cursor: pointer;}.jimu-widget-map-filter .refresh-done-icon:after {content: url("../images/check.png"); width: 16px; height: 16px; cursor: hand; cursor: pointer;}.jimu-widget-map-filter .operator-class {}.jimu-widget-map-filter .value-class {}',
"*now":function(y){y(['dojo/i18n!*preload*widgets/GroupFilter/nls/Widget*["ar","bs","ca","cs","da","de","en","el","es","et","fi","fr","he","hr","hu","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sl","sr","sv","th","tr","zh-cn","uk","vi","zh-hk","zh-tw","ROOT"]'])},"*noref":1}});
define("dojo/_base/declare dijit/_WidgetsInTemplateMixin jimu/BaseWidget dijit jimu/dijit/FilterParameters dojo/dom dojo/dom-construct dojo/dom-class dojo/dom-attr dojo/dom-style dojo/on dojo/query dojo/string dojo/_base/lang dojo/_base/array dojo/date/locale dojo/keys dojo/Deferred dojo/topic dijit/form/Select dijit/form/TextBox dijit/form/DateTextBox dijit/form/NumberTextBox dijit/registry jimu/LayerInfos/LayerInfos jimu/utils jimu/FilterManager esri/tasks/query esri/tasks/QueryTask esri/geometry/geometryEngine esri/layers/FeatureLayer ./SaveJSON ./ReadJSON ./LayersHandler dojox/html/entities dijit/form/CheckBox".split(" "),function(y,
x,v,t,w,n,f,m,z,u,d,l,I,g,h,A,r,S,T,D,J,K,L,B,M,p,N,E,F,C,O,P,Q,R,G){return y([v,x],{baseClass:"jimu-widget-map-filter",layerList:null,msLayersDesc:null,grpSelect:null,groupCounter:0,groupCurrVal:null,groupMatrix:[],w2wHistory:[],defaultDef:null,runTimeConfig:null,useDomain:null,useDate:null,useValue:null,useCaseSearch:null,runInitial:!1,graphicsHolder:null,slAppendChoice:null,chkAppendToDef:null,persistOnClose:!0,filterExt:null,isHosted:null,firstOpen:!0,bypassActive:!1,dayInMS:86399E3,urlParameters:null,
urlLoadHandler:null,postCreate:function(){this.inherited(arguments);this.defaultDef=[];this.graphicsHolder=[];this.urlParameters=this.getUrlParam("groupfilter","");this.handleKeyDownEvents();this.registerEventHandler();this.config.hasOwnProperty("headerText")&&""!==this.config.headerText&&(this.groupSelectHeader.innerHTML=this.config.headerText);this.config.hasOwnProperty("hideHeaderSelection")&&this.config.hideHeaderSelection&&1===this.config.groups.length&&(u.set(this.groupSelectHeader,"display",
"none"),u.set(this.groupPicker,"display","none"))},startup:function(){this.inherited(arguments);this.config.optionsMode&&m.add(this.optionsIcon,"hide-items");null!==this.urlParameters&&""!==this.urlParameters?this.runInitial=!0:""!==this.config.groups[0].defaultVal&&""!==this.config.groups[0].operator&&(this.runInitial=!0);"undefined"!==typeof this.config.webmapAppendMode&&(this.chkAppendToDef.checked=this.config.webmapAppendMode,this.slAppendChoice.value=this.config.slAppendChoice);"undefined"!==
typeof this.config.persistOnClose?this.persistOnClose=this.config.persistOnClose:this.config.persistOnClose=this.persistOnClose;this.chkPersistDef.set("checked",this.persistOnClose);this.populateGroupState();this.createMapLayerList()},loadAllURLParams:function(a){if(null!==this.urlParameters&&""!==this.urlParameters){var b=[],c=Object.keys(this.urlParameters);h.forEach(this.groupMatrix,g.hitch(this,function(e){b=[];fieldList=[];valueList=[];-1<c.indexOf(e.name)&&(h.forEach(e.layers,g.hitch(this,function(e,
c){e.id===a.id&&(this._applyFilter(a.layerObject,e.expression,!1),b.push({field:e.field,value:e.value[c]?e.value[c]:"",operator:"\x3d",conjunc:this.config.slAppendChoice}))})),0<b.length&&this._publishData(b,e.name))}))}},populateGroupState:function(){this.groupMatrix=[];h.map(this.config.groups,g.hitch(this,function(a){var b=[];h.forEach(a.layers,g.hitch(this,function(c){var e="",q=[],d="";if(null!==this.urlParameters&&""!==this.urlParameters&&-1<Object.keys(this.urlParameters).indexOf(a.name)){var f=
this.urlParameters[a.name];0<f.length&&(1===f.length?(e=c.field+" \x3d '"+p.stripHTML(f[0])+"'",q.push(p.stripHTML(f[0])),d=c.field):h.forEach(f,g.hitch(this,function(a,b){e=b===f.length-1?e+" ("+c.field+" \x3d '"+p.stripHTML(a)+"')":e+" ("+c.field+" \x3d '"+p.stripHTML(a)+"') "+this.config.slAppendChoice;q.push(p.stripHTML(a));d=c.field})))}b.push({id:c.layer,expression:e,value:q,field:d})}));this.groupMatrix.push({name:a.name,layers:b})}))},btnNewRowAction:function(){var a=h.filter(this.config.groups,
g.hitch(this,function(a){return a.name===this.grpSelect.value}));if(0<a.length){var b=this.checkDefaultValue(a[0]),c=this.checkDefaultOperator(a[0]);this.createNewRow({operator:c,value:b,conjunc:"OR",state:"new",group:a[0].name})}else b=this.checkDefaultValue(this.config.groups[0]),c=this.checkDefaultOperator(this.config.groups[0]),this.createNewRow({operator:c,value:b,conjunc:"OR",state:"new",group:this.config.groups[0].name})},createMapLayerList:function(){M.getInstance(this.map,this.map.itemInfo).then(g.hitch(this,
function(a){a._layerInfos&&0<a._layerInfos.length&&(this.layerList=a._layerInfos,this._pullMapServiceFields(a._layerInfos),h.forEach(this.layerList,g.hitch(this,function(a){"ArcGISTiledMapServiceLayer"!==a.originOperLayer.layerType&&"VectorTileLayer"!==a.originOperLayer.layerType&&"undefined"===typeof a.originOperLayer.featureCollection&&("undefined"!==typeof a.layerObject._defnExpr?this.defaultDef.push({layer:a.id,definition:a.layerObject._defnExpr,visible:a.layerObject.visible}):"undefined"!==typeof a.layerObject.defaultDefinitionExpression&&
"function"===typeof a.layerObject.getDefinitionExpression()?this.defaultDef.push({layer:a.id,definition:a.layerObject.getDefinitionExpression(),visible:a.layerObject.visible}):"undefined"!==typeof a.layerObject.layerDefinitions?this.defaultDef.push({layer:a.id,definition:a.layerObject.layerDefinitions,visible:a._visible}):this.defaultDef.push({layer:a.id,definition:"",visible:a.layerObject.visible}),this.loadAllURLParams(a))})))}))},_pullMapServiceFields:function(a){this.msLayersDesc=[];a=new R({layers:a});
this.own(d(a,"complete",g.hitch(this,function(a){h.forEach(a.data.items,g.hitch(this,function(a){0<a.children.length&&this.msLayersDesc.push(a)}));this.createGroupSelection()})));this.own(d(a,"error",g.hitch(this,function(){console.log("error")})));a.getAllMapLayers()},checkDomainUse:function(a){this.useValue=this.useDomain=null;h.forEach(this.config.groups,g.hitch(this,function(b){b.name===a.group&&h.forEach(b.layers,g.hitch(this,function(a){h.forEach(this.layerList,g.hitch(this,function(b){"undefined"!==
typeof b.newSubLayers&&(0<b.newSubLayers.length?h.forEach(this.msLayersDesc,g.hitch(this,function(b){h.forEach(b.children,g.hitch(this,function(b){b.id===a.layer&&h.forEach(b.children,g.hitch(this,function(b){b.name===a.field&&""!==a.useDomain&&(this.useValue=a.useDomain)}))}))})):a.layer===b.id&&h.forEach(b.layerObject.fields,g.hitch(this,function(b){b.name===a.field&&""!==a.useDomain&&(this.useValue=a.useDomain,"undefined"!==typeof b.domain&&(this.useDomain=b.domain))})))}))}))}))},checkDateUse:function(a){this.useDate=
null;h.forEach(this.config.groups,g.hitch(this,function(b){b.name===a.group&&h.forEach(b.layers,g.hitch(this,function(a){h.forEach(this.layerList,g.hitch(this,function(b){a.layer===b.id&&h.forEach(b.layerObject.fields,g.hitch(this,function(b){b.name===a.field&&0<=b.type.indexOf("Date")&&(this.useDate=!0)}))}))}))}))},checkCaseSearch:function(a){this.useCaseSearch=null;h.forEach(this.config.groups,g.hitch(this,function(b){b.name===a.group&&(this.useCaseSearch=b.caseSearch)}))},checkIsHosted:function(a){this.isHosted=
!1;p.isHostedService(a.url)&&(this.isHosted=!0)},createGroupSelection:function(){var a=[],b="";h.forEach(this.config.groups,g.hitch(this,function(b){null!==this.urlParameters&&""!==this.urlParameters&&Object.keys(this.urlParameters);var e={};e.value=b.name;e.label=b.name;e.selected=!1;a.push(e)}));f.empty("groupPicker");this.removeAllRows();this.grpSelect=(new D({options:a,tabIndex:0,"aria-label":this.nls.labels.selectGroup})).placeAt(this.groupPicker);this.grpSelect.startup();this.checkDomainUse({group:this.grpSelect.value});
this.checkDateUse({group:this.grpSelect.value});this.checkCaseSearch({group:this.grpSelect.value});this.groupCurrVal=this.grpSelect.value;"undefined"!==typeof this.config.groups[0]&&(b=this.config.groups[0].desc,this.groupDesc.innerHTML=p.stripHTML(b));this.own(d(this.grpSelect,"change",g.hitch(this,function(a){this.config.webmapAppendMode||this.resetLayerDef({group:this.groupCurrVal});this.removeAllRows();this.checkDomainUse({group:a});this.checkDateUse({group:a});this.checkCaseSearch({group:a});
this.reconstructRows(a);this.updateGroupDesc(a);this.groupCurrVal=a;this.config.webmapAppendMode||h.forEach(this.config.groups,g.hitch(this,function(b){b.name===a&&b.hasOwnProperty("def")&&setTimeout(g.hitch(this,this.setFilterLayerDef),1E3)}))})));if(null!==this.urlParameters&&""!==this.urlParameters)if(b=h.filter(this.config.groups,g.hitch(this,function(a){return a.name===this.grpSelect.get("value")})),0<b.length)this.addCriteriaByURL(b[0]);else{var b=this.checkDefaultValue(this.config.groups[0]),
c=this.checkDefaultOperator(this.config.groups[0]);this.createNewRow({operator:c,value:b,conjunc:"OR",state:"new",group:this.config.groups[0].name})}else b=this.checkDefaultValue(this.config.groups[0]),c=this.checkDefaultOperator(this.config.groups[0]),this.createNewRow({operator:c,value:b,conjunc:"OR",state:"new",group:this.config.groups[0].name});null!==this.urlParameters&&""!==this.urlParameters&&(b=h.map(this.config.groups,g.hitch(this,function(a){return a.name})),c=Object.keys(this.urlParameters),
JSON.stringify(b),JSON.stringify(c));this._setFirstLastNodeOnMainScreen()},createNewRow:function(a){var b=n.byId("tblPredicates"),c;if("new"===a.state){var e=0;1<b.rows.length?(c=b.rows[b.rows.length-1].cells[0].firstChild,c=c.rows[2].cells[0],this.createConditionSelection(c,a),e=b.rows.length):1===b.rows.length&&(e=1,c=b.rows[b.rows.length-1].cells[0].firstChild,c=c.rows[2].cells[0],this.createConditionSelection(c,a));null!==this.urlParameters&&""!==this.urlParameters&&"undefined"!==typeof this.urlParameters[a.group]&&
(a.value=this.urlParameters[a.group][e])}var e=b.insertRow(-1),d=e.insertCell(0);c=e.insertCell(1);m.add(d,"criteriaCellSize");m.add(c,"deleteCellSize");var k=f.create("table",{border:"0",width:"100%"},d),d=k.insertRow(-1),h=d.insertCell(0),H=k.insertRow(-1).insertCell(0),k=k.insertRow(-1).insertCell(0);u.set(k,{paddingLeft:"3px",paddingRight:"3px"});m.add(d,"operator-class");this.colorRows();this.createOperatorSelection(h,a);this.removeTableRow(c,e,b.rows.length);this.createInputFilter(H,a);this.resize();
this.config.simpleMode&&(m.add(this.btnCriteria,"hide-items"),m.add(d,"hide-items"),l(".container").style("borderTop","0px"),u.set(H,{paddingLeft:"0px",paddingRight:"0px"}));"reload"===a.state?""!==a.conjunc&&(c=b.rows[b.rows.length-1].cells[0].firstChild,c=c.rows[2].cells[0],this.createConditionSelection(c,a)):this.runInitial&&(this.runInitial=!1,setTimeout(g.hitch(this,this.setFilterLayerDef),1E3))},colorRows:function(){var a=n.byId("tblPredicates").rows;h.forEach(a,function(a,c){0===c%2?m.remove(a,
"tableRow"):m.add(a,"tableRow")})},createOperatorSelection:function(a,b){a=(new D({options:[{value:"\x3d",label:this.nls.inputs.optionEQUAL},{value:"\x3c\x3e",label:this.nls.inputs.optionNOTEQUAL},{value:"\x3e",label:this.nls.inputs.optionGREATERTHAN},{value:"\x3e\x3d",label:this.nls.inputs.optionGREATERTHANEQUAL},{value:"\x3c",label:this.nls.inputs.optionLESSTHAN},{value:"\x3c\x3d",label:this.nls.inputs.optionLESSTHANEQUAL},{value:"START",label:this.nls.inputs.optionSTART},{value:"END",label:this.nls.inputs.optionEND},
{value:"LIKE",label:this.nls.inputs.optionLIKE},{value:"NOT LIKE",label:this.nls.inputs.optionNOTLIKE},{value:"d\x3c\x3d",label:this.nls.inputs.optionONORBEFORE},{value:"d\x3e\x3d",label:this.nls.inputs.optionONORAFTER}],"class":"operatorSelect",tabIndex:0,"aria-label":this.nls.inputs.operatorLabel})).placeAt(a);a.startup();a.set("value",G.decode(b.operator));this.own(d(a,"click",g.hitch(this,function(){})));this.own(d(a,"change",g.hitch(this,function(){})))},createInputFilter:function(a,b){f.empty(a);
if(null!==this.useDomain)if("undefined"!==typeof this.useDomain.codedValues){var c=new w;c.placeAt(a);c.startup();this.createValueList(b,c)}else c="",""!==b.value&&(c=Number(b.value)),(new L({value:c,placeHolder:I.substitute(this.nls.inputs.textboxNumber,{0:this.useDomain.minValue,1:this.useDomain.maxValue}),"class":"userInputNormal",constraints:{min:this.useDomain.minValue,max:this.useDomain.maxValue}})).placeAt(a).startup(),this.formatSpacing(a);else!0===this.useValue?(c=new w,c.placeAt(a),c.startup(),
this.createValueList(b,c)):(!0===this.useDate?(b=A.format(""!==b.value?new Date(b.value):new Date,{selector:"date",fullYear:!0}),c=(new K({value:b,placeHolder:b,"class":"userInputNormal"})).placeAt(a),c.startup(),c.set("displayedValue",b)):(new J({value:b.value,placeHolder:this.nls.inputs.textboxText,"class":"userInputNormal"})).placeAt(a).startup(),this.formatSpacing(a))},createValueList:function(a,b){var c={},e=[],f="";h.forEach(this.config.groups,g.hitch(this,function(k){k.name===this.grpSelect.value&&
h.forEach(k.layers,g.hitch(this,function(k){f="";h.forEach(this.layerList,g.hitch(this,function(q){0<q.newSubLayers.length?h.forEach(this.msLayersDesc,g.hitch(this,function(q){h.forEach(q.children,g.hitch(this,function(h){if(h.id===k.layer){if(f!==h.id&&!0===k.useDomain){var q=new O(h.url);this.own(d(q,"load",g.hitch(this,function(){this._callFilterDijit(k,a,h.url,q.toJson().layerDefinition,e,c,b)})))}f=h.id}}))})):k.layer===q.id&&!0===k.useDomain&&this._callFilterDijit(k,a,q.layerObject.url,q.layerObject.toJson().layerDefinition,
e,c,b)}))}))}))},_callFilterDijit:function(a,b,c,e,g,d,f){var k={fieldObj:{}};k.fieldObj.name=a.field;k.fieldObj.label=a.field;k.fieldObj.shortType=a.dataType.replace("esriFieldType","").toLowerCase();if("guid"!==k.fieldObj.shortType||"globalid"!==k.fieldObj.shortType)k.fieldObj.shortType="string";"date"!==k.fieldObj.shortType&&"string"!==k.fieldObj.shortType&&(k.fieldObj.shortType="number");k.fieldObj.type=a.dataType;k.operator=k.fieldObj.shortType+"OperatorIs";k.valueObj={};k.valueObj.isValid=!0;
k.valueObj.type="unique";-1<a.dataType.indexOf("Integer")||-1<a.dataType.indexOf("Double")||-1<a.dataType.indexOf("Short")?k.valueObj.value=this.useDomain?Number(b.value):b.value:k.valueObj.value=b.value;k.interactiveObj={};k.interactiveObj.prompt="";k.interactiveObj.hint="";k.caseSensitive=!1;g.push(k);d.logicalOperator="OR";d.expr="";d.parts=g;null!==e.id?f.build(c,e,d,e.id):(a=a.layer.replace(/.([^.]*)$/,"_$1"),f.build(c,e,d,a));c=l(".jimu-single-filter-parameter");h.forEach(c,function(a){var b=
l("table",a);h.forEach(b,function(a){z.set(a,"cellpadding","1");z.set(a,"cellspacing","1")});a=l("colgroup",a);0<a.length&&z.set(a[0].childNodes[1],"width","0px")})},formatSpacing:function(a){u.set(a,{paddingLeft:"2px",paddingRight:"2px"})},createConditionSelection:function(a,b){f.empty(a);a=(new D({options:[{value:"OR",label:this.nls.inputs.optionOR},{value:"AND",label:this.nls.inputs.optionAND}],"class":"conjuncSelect",tabIndex:0,"aria-label":this.nls.inputs.conjuncLabel})).placeAt(a);a.startup();
a.set("value",b.conjunc)},removeTableRow:function(a,b,c){1<c&&(c=f.create("div",{"class":"deleteCell",innerHTML:"",tabIndex:0,"aria-label":this.nls.buttons.deleteCriteriaRow}),this.own(d(c,"click",g.hitch(this,function(){f.destroy(b);var a=n.byId("tblPredicates");1<=a.rows.length&&f.empty(a.rows[a.rows.length-1].cells[0].firstChild.rows[2].cells[0]);this.colorRows()}))),this.own(d(c,"keydown",g.hitch(this,function(a){if(a.keyCode===r.ENTER||a.keyCode===r.SPACE)f.destroy(b),a=n.byId("tblPredicates"),
1<=a.rows.length&&f.empty(a.rows[a.rows.length-1].cells[0].firstChild.rows[2].cells[0]),this.colorRows()}))),f.place(c,a))},removeAllRows:function(){var a=n.byId("tblPredicates");if(1<=a.rows.length){var b=B.byNode(a.rows[0].cells[0].firstChild.rows[1].cells[0].childNodes[0]);"undefined"!==typeof b&&t.byId(b.id).destroyRecursive(!0);f.destroy(a.rows[0]);this.removeAllRows()}},reconstructRows:function(a){""!==a?h.forEach(this.config.groups,g.hitch(this,function(b){if(b.name===a){var c="",e="\x3d";
"undefined"!==typeof b.def?0<b.def.length?h.forEach(b.def,g.hitch(this,function(a){this.createNewRow({value:a.value,operator:a.operator,conjunc:a.conjunc,state:"reload",group:b.name})})):(c=this.checkDefaultValue(b),e=this.checkDefaultOperator(b),this.createNewRow({operator:e,value:c,conjunc:"OR",state:"new",group:b.name})):null!==this.urlParameters&&""!==this.urlParameters?this.addCriteriaByURL(b):(c=this.checkDefaultValue(b),e=this.checkDefaultOperator(b),this.createNewRow({operator:e,value:c,conjunc:"OR",
state:"new",group:b.name}))}})):this.createNewRow({operator:"\x3d",value:"",conjunc:"OR",state:"new",group:this.grpSelect.value})},checkDefaultValue:function(a){var b="";null!==this.urlParameters&&""!==this.urlParameters?"undefined"!==typeof this.urlParameters[a.name]&&(b=this.urlParameters[a.name][0]):""!==a.defaultVal&&(b=a.defaultVal);return b},checkDefaultOperator:function(a){var b="\x3d";""!==a.operator&&(b=a.operator);return b},parseTable:function(){var a=[],b=n.byId("tblPredicates").rows;h.forEach(b,
g.hitch(this,function(b,e){if(0<=e){var c=b.cells[0].firstChild;b=B.byNode(c.rows[0].cells[0].childNodes[0]);var d=B.byNode(c.rows[1].cells[0].childNodes[0]);e={};"undefined"!==typeof c.rows[2].cells[0].childNodes[0]?e=B.byNode(c.rows[2].cells[0].childNodes[0]):e.value="";var g="";if("undefined"!==typeof d.partsObj){if(d=d.getValueProviders()[0].getValueObject())g=d.value}else g=d.value;c=l(".dijitReset.dijitInputInner",c.rows[1].cells[0].childNodes[0]);0<c.length&&""===c[0].value&&(g="");a.push({operator:b.value,
userValue:g,conjunc:e.value})}}));return a},formatDate:function(a){a=new Date(a);var b=A.format(a,{datePattern:"yyyy-MM-dd",selector:"date"});a=A.format(a,{selector:"time",timePattern:"HH:mm:ss"});return b+" "+a},addSecond:function(a){return new Date((new Date(a)).setSeconds(59))},substractSecond:function(a){a=new Date(a);a.setSeconds(a.getSeconds()-1);return a},addDay:function(a){a=new Date(a);return new Date(a.getTime()+this.dayInMS)},subtractDay:function(a){a=new Date(a);return new Date(a.getTime()-
this.dayInMS)},createQuery:function(a,b,c,e,d,g,f){isNaN(e)&&(e=G.decode(e.replace(/'/g,"''")));if(""===e)return"\x3c\x3e"===c||"NOT LIKE"===c?-1<g.indexOf("Double")||-1<g.indexOf("Single")?[b,"IS NOT NULL",d].join(" ")+" ":[b,"\x3c\x3e '' OR",b,"IS NOT NULL",d].join(" ")+" ":-1<g.indexOf("Double")||-1<g.indexOf("Single")?[b,"IS NULL",d].join(" ")+" ":[b,"\x3d '' OR",b,"IS NULL",d].join(" ")+" ";if("LIKE"===c||"NOT LIKE"===c)!1===a?this.useCaseSearch?e="'%"+e+"%'":(e="UPPER('%"+e+"%')",b="UPPER("+
b+")"):e="'%"+e+"%'";else if("START"===c)c="LIKE",!1===a?this.useCaseSearch?e="'"+e+"%'":(e="UPPER('"+e+"%')",b="UPPER("+b+")"):e+="%";else if("END"===c)c="LIKE",!1===a?this.useCaseSearch?e="'%"+e+"'":(e="UPPER('%"+e+"')",b="UPPER("+b+")"):e="%"+e;else if(!1===a)if(-1<g.indexOf("Date"))if("undefined"!==typeof f.layerObject?this.checkIsHosted(f.layerObject):this.checkIsHosted(f),"\x3d"===c||"\x3c\x3e"===c)c="\x3d"===c?"BETWEEN":"NOT BETWEEN",e=this.isHosted?"'"+this.formatDate(e)+"' AND '"+this.formatDate(this.addDay(e))+
"'":"timestamp '"+this.formatDate(this.substractSecond(e))+"' AND timestamp '"+this.formatDate(this.addDay(e))+"'";else if("\x3e"===c)e=this.isHosted?"'"+this.formatDate(this.addDay(e))+"'":"timestamp '"+this.formatDate(this.addDay(e))+"'";else{if("d\x3c\x3d"===c||"d\x3e\x3d"===c)c=c.substr(1);"\x3c\x3d"===c&&(e=this.addDay(e));e=this.isHosted?"'"+this.formatDate(e)+"'":"timestamp '"+this.formatDate(e)+"'"}else this.useCaseSearch?e="'"+e+"'":(e="UPPER('"+e+"')",b="UPPER("+b+")");return[b,c,e,d].join(" ")+
" "},setFilterLayerDef:function(){this.filterExt=null;this.graphicsHolder=[];var a=this.parseTable();h.forEach(this.config.groups,g.hitch(this,function(b){if(this.grpSelect.value===b.name){var c=[];h.forEach(this.layerList,g.hitch(this,function(e){var d=[],f="",m="",l="";h.forEach(b.layers,g.hitch(this,function(k,q){"undefined"!==typeof b.appendSameLayer&&!0===b.appendSameLayer?m!==k.layer?""!==f&&(this.setupFilterToApply(e,l,f,d,b),f=""):""!==m&&(f=f+" "+b.appendSameLayerConjunc+" ",f===" "+b.appendSameLayerConjunc+
" "&&(f="")):f="";if(e.id===k.layer)b.def=[],l="FeatureLayer",h.forEach(a,g.hitch(this,function(a){h.forEach(e.layerObject.fields,g.hitch(this,function(d){if(d.name===k.field){if(-1<d.type.indexOf("Integer")||-1<d.type.indexOf("Double")||-1<d.type.indexOf("Single")){var g=p.sanitizeHTML(a.userValue);if(!1===isNaN(g)){if(0!==p.sanitizeHTML(a.userValue)%1){var h=g.split(".");6<h[1].length&&(h[1]=h[1].substring(0,6),g=h[0]+"."+h[1]);"\x3d"===a.operator?a.operator="LIKE":"\x3c\x3e"===a.operator&&(a.operator=
"NOT LIKE")}f+=this.createQuery(!0,k.field,a.operator,g,a.conjunc,d.type,e)}else console.log("Not a Number")}else-1<d.type.indexOf("Date")?""!==a.userValue?(g=new Date(p.sanitizeHTML(a.userValue)),-1<d.type.indexOf("Time")?A.format(g,{fullYear:!0,datePattern:"yyyy-MM-dd, HH:mm:ss a"}):A.format(g,{fullYear:!0,datePattern:"yyyy-MM-dd"}),f+=this.createQuery(!1,k.field,a.operator,g,a.conjunc,d.type,e)):f+=this.createQuery(!1,k.field,a.operator,p.sanitizeHTML(a.userValue),a.conjunc,d.type,e):f+=this.createQuery(!1,
k.field,a.operator,p.sanitizeHTML(a.userValue),a.conjunc,d.type,e);b.def.push({field:k.field,value:p.sanitizeHTML(a.userValue),operator:a.operator,conjunc:a.conjunc});c.push({field:k.field,value:p.sanitizeHTML(a.userValue),operator:a.operator,conjunc:a.conjunc})}}))}));else if(0<=k.layer.indexOf(e.id)){b.def=[];l="MapService";var n=k.layer.split(".");h.forEach(a,g.hitch(this,function(a){if(""!==a.userValue)if(-1<k.dataType.indexOf("Integer")||-1<k.dataType.indexOf("Double"))f+=this.createQuery(!0,
k.field,a.operator,p.sanitizeHTML(a.userValue),a.conjunc,k.dataType,e);else if(-1<k.dataType.indexOf("Date"))if(""!==a.userValue){var d=new Date(p.sanitizeHTML(a.userValue)),d=-1<k.dataType.indexOf("Time")?A.format(d,{fullYear:!0,datePattern:"yyyy-MM-dd, HH:mm:ss a"}):A.format(d,{fullYear:!0,datePattern:"yyyy-MM-dd"});f+=this.createQuery(!1,k.field,a.operator,d,a.conjunc,k.dataType,e)}else f+=this.createQuery(!1,k.field,a.operator,p.sanitizeHTML(a.userValue),a.conjunc,k.dataType,e);else f+=this.createQuery(!1,
k.field,a.operator,p.sanitizeHTML(a.userValue),a.conjunc,k.dataType,e);else f+=this.createQuery(!1,k.field,a.operator,p.sanitizeHTML(a.userValue),a.conjunc,k.dataType,e);b.def.push({field:k.field,value:p.sanitizeHTML(a.userValue),operator:a.operator,conjunc:a.conjunc});c.push({field:k.field,value:p.sanitizeHTML(a.userValue),operator:a.operator,conjunc:a.conjunc})}));""!==f&&(d[n[1]]=f.trim())}m=k.layer;"undefined"!==typeof b.appendSameLayer&&!1===b.appendSameLayer?this.setupFilterToApply(e,l,f,d,
b):q===b.layers.length-1&&this.setupFilterToApply(e,l,f,d,b)}))}));"undefined"!==typeof c&&0<c.length&&this._publishData(c,this.grpSelect.value)}}))},setupFilterToApply:function(a,b,c,e,d){if("FeatureLayer"===b){if(""!==c){var f=c.trim();if(this.chkAppendToDef.checked){f="";h.forEach(this.groupMatrix,g.hitch(this,function(b){b.name===d.name&&h.forEach(b.layers,g.hitch(this,function(b,e){b.id===a.id&&(b.expression=c.trim())}))}));var l=[];h.forEach(this.groupMatrix,g.hitch(this,function(b){l=l.concat(h.filter(b.layers,
g.hitch(this,function(b){return""!==b.expression&&b.id===a.id})))}));h.forEach(l,g.hitch(this,function(a,b){""!==a.expression&&(f=b<l.length-1?f+" ("+a.expression+") "+this.slAppendChoice.value+" ":f+" ("+a.expression+") ")}))}this._applyFilter(a.layerObject,f,!1)}}else"MapService"===b&&0<e.length&&(this.chkAppendToDef.checked?h.forEach(this.defaultDef,g.hitch(this,function(b){var f=!1,k=-1;if(b.layer===a.id){for(slot in e)for(var l in b.definition)slot===l?(f=!0,k=l):""===e[slot]&&(e[slot]=c);this.newMSExprForAppend(d,
a,e);var m=[];h.forEach(this.groupMatrix,g.hitch(this,function(b){m=m.concat(h.filter(b.layers,g.hitch(this,function(b){return""!==b.expression&&-1<b.id.indexOf(a.id)})))}));var q=[];h.forEach(m,g.hitch(this,function(a,c){""!==a.expression&&(c=a.id.split("."),q[c[1]]="undefined"!==typeof q[c[1]]?f&&c[1]===k?"("+b.definition[l]+") "+this.slAppendChoice.value+" "+q[c[1]]+" "+this.slAppendChoice.value+" ("+a.expression+") ":q[c[1]]+" "+this.slAppendChoice.value+" ("+a.expression+") ":f&&c[1]===k?"("+
b.definition[l]+") "+this.slAppendChoice.value+" "+a.expression:a.expression,e=q)}));a.layerObject.setLayerDefinitions(e);this._zoomOnFilter(a.layerObject)}})):(a.layerObject.setLayerDefinitions(e),this._zoomOnFilter(a.layerObject)))},newMSExprForAppend:function(a,b,c){h.forEach(this.groupMatrix,g.hitch(this,function(e){e.name===a.name&&h.forEach(e.layers,g.hitch(this,function(a,e){-1<a.id.indexOf(b.id)&&h.forEach(b.layerObject.layerInfos,g.hitch(this,function(e){a.id===b.id+"."+e.id&&(a.expression=
c[e.id])}))}))}))},clearCriteria:function(a){"undefined"===typeof a.group&&(a.group=this.grpSelect.value);h.forEach(this.config.groups,g.hitch(this,function(a){a.hasOwnProperty("def")&&delete a.def}));this.removeAllRows();this.w2wHistory=[];this.checkDomainUse({group:a.group});this.checkDateUse({group:a.group});this.checkCaseSearch({group:a.group});this.reconstructRows(a.group);this.resetLayerDef(a)},resetLayerDef:function(a){"undefined"===typeof a.group&&(a.group=this.grpSelect.value);this.populateGroupState();
h.forEach(this.config.groups,g.hitch(this,function(b){b.name===a.group&&h.forEach(b.layers,g.hitch(this,function(a){h.forEach(this.layerList,g.hitch(this,function(a){h.forEach(this.defaultDef,g.hitch(this,function(b){b.layer===a.id&&("undefined"!==typeof a.layerObject.defaultDefinitionExpression?this._applyFilter(a.layerObject,b.definition,!0):"undefined"!==typeof a.layerObject.layerDefinitions?a.layerObject.setLayerDefinitions(b.definition):this._applyFilter(a.layerObject,b.definition,!0),a.layerObject.setVisibility(b.visible))}))}))}))}))},
updateGroupDesc:function(a){h.forEach(this.config.groups,g.hitch(this,function(b){b.name===a&&(this.groupDesc.innerHTML=p.stripHTML(b.desc))}))},toggleSaveFilter:function(a){0<l(".saveTD").length?(a=l(".container"),0<a.length&&(m.replace(n.byId("saveTD"),"saveTDClose","saveTD"),a.style("display","none"),l(".saveContainer").style("display","block"),l(".groupContainer").style("display","none"),l(".buttonContainer").style("display","none"),this._updateTabNodes("save"))):(a=l(".saveTDClose"),0<a.length&&
(m.replace(a[0],"saveTD","saveTDClose"),a=l(".container"),0<a.length&&(m.replace(n.byId("saveTD"),"saveTD","saveTDClose"),a.style("display","block"),l(".saveContainer").style("display","none"),l(".groupContainer").style("display","block"),l(".buttonContainer").style("display","block"),m.replace("refreshDiv","refresh-icon","refresh-done-icon"),this._updateTabNodes("filter"))))},saveJsonToFile:function(){var a=new P({config:this.config});this.own(d(a,"complete",g.hitch(this,function(){console.log("save done")})));
a.exportsJson(this.nls.files.jsonFile+".json",this.config)},readJsonToConfig:function(){l(".loadProgressHeader").style("display","block");l(".loadProgressShow").style("display","block");var a=new Q({config:this.config,jsonFile:this.jsonFileInput.files});this.own(d(a,"complete",g.hitch(this,function(a){this.config=JSON.parse(a.UserSettings);this.resetLayerDef({group:this.grpSelect.value});this.removeAllRows();this.checkDomainUse({group:this.grpSelect.value});this.checkDateUse({group:this.grpSelect.value});
this.reconstructRows(this.grpSelect.value);this.updateGroupDesc(this.grpSelect.value);setTimeout(g.hitch(this,this.setFilterLayerDef),1E3);l(".loadProgressHeader").style("display","none");l(".loadProgressShow").style("display","none");this.jsonFileInput.value=null;this.toggleSaveFilter()})));this.own(d(a,"error",g.hitch(this,function(){this.jsonFileInput.value=null;l(".loadProgressHeader").style("display","none");l(".loadProgressShow").style("display","none")})));a.checkFileReader();return!0},_publishData:function(a,
b){var c=[],e=[],d=b?b:this.grpSelect.value;h.forEach(a,g.hitch(this,function(a){-1===c.indexOf(a.field)&&c.push(a.field);-1===e.indexOf(a.value)&&e.push(a.value)}));a={fields:c,values:e,groupName:d};var f=!0;h.forEach(this.w2wHistory,g.hitch(this,function(a){a.hasOwnProperty("groupName")&&a.groupName===d&&(a.fields=c,a.values=e,f=!1)}));f&&this.w2wHistory.push(a);setTimeout(g.hitch(this,function(){this.publishData({message:this.w2wHistory})}),500)},resize:function(){var a=l(".jimu-single-filter-parameter");
0<a.length&&h.forEach(a,g.hitch(this,function(a){a=l("colgroup",a);0<a.length&&z.set(a[0].childNodes[1],"width","0px")}));320>=window.innerWidth?(m.add(this.btnCriteria,"hide-items"),l(".operator-class").style("display","none"),l(".container").style("borderTop","0px"),l(".value-class").style("paddingTop","-10px")):this.config.simpleMode||(m.remove(this.btnCriteria,"hide-items"),l(".operator-class").style("display","block"),l(".container").style("borderTop","3px solid"),l(".value-class").style("paddingTop",
"0px"))},_applyFilter:function(a,b,c){var d=!1;"AND"===this.slAppendChoice.value&&(d=!0);N.getInstance().applyWidgetFilter(a.id,this.id,b,this.chkAppendToDef.checked,d,this.config.zoomMode);c||this._zoomOnFilter(a)},_zoomOnFilter:function(a){if(this.config.zoomMode)if("undefined"!==typeof a.layerDefinitions&&0<a.layerDefinitions.length)var b=d(this.map,"update-end",g.hitch(this,function(){var c=new E;c.outFields=["*"];for(var d in a.layerDefinitions)if(a.layerDefinitions.hasOwnProperty(d)){var e=
a.url+"/"+d;c.where=a.layerDefinitions[d];c.returnGeometry=!0;c.outSpatialReference=this.map.spatialReference;(new F(e)).executeForExtent(c,g.hitch(this,this._queryExtentToZoom))}b.remove()}));else{var c=new E;c.outFields=["*"];if("ArcGISImageServiceLayer"===a.type){var e=a.url;c.where=a.getDefinitionExpression();c.returnGeometry=!0;c.outSpatialReference=this.map.spatialReference;(new F(e)).executeForExtent(c,g.hitch(this,this._queryExtentToZoom))}else a.queryExtent(c,g.hitch(this,this._queryExtentToZoom))}},
_queryExtentToZoom:function(a){if("undefined"!==typeof a.extent&&null!==a.extent){var b;b=102100!==a.extent.spatialReference.wkid&&102113!==a.extent.spatialReference.wkid&&3857!==a.extent.spatialReference.wkid&&4326!==a.extent.spatialReference.wkid?C.buffer(a.extent,10,9002,!1).getExtent():C.geodesicBuffer(a.extent,10,9002,!1).getExtent();null===this.filterExt&&(this.filterExt=b);b=b.update(this.filterExt.xmin<b.xmin?this.filterExt.xmin:b.xmin,this.filterExt.ymin<b.ymin?this.filterExt.ymin:b.ymin,
this.filterExt.xmax>b.xmax?this.filterExt.xmax:b.xmax,this.filterExt.ymax>b.ymax?this.filterExt.ymax:b.ymax,b.spatialReference);this.filterExt=b=102100!==a.extent.spatialReference.wkid&&102113!==a.extent.spatialReference.wkid&&3857!==a.extent.spatialReference.wkid&&4326!==a.extent.spatialReference.wkid?C.buffer(b,200,9002,!1).getExtent():C.geodesicBuffer(b,200,9002,!1).getExtent();this.map.setExtent(b)}},refreshData:function(){this.onLayerUpdate();m.replace("refreshDiv","refresh-done-icon","refresh-icon")},
onLayerUpdate:function(){this.grpSelect&&(this.removeAllRows(),this.reconstructRows(this.grpSelect.value))},getUrlVars:function(a){var b={},c=decodeURI(window.location.href),c=c.replace(/[+]/g," "),c=c.replace(/%+3+A+/g,":"),c=c.replace(/%+3+D+/g,"\x3d"),c=c.replace(/%+2+C+/g,",");c.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(c,d,f){d===a&&(""!==f&&(f=JSON.parse(decodeURI(f))),b[d]=f)});return b},getUrlParam:function(a,b){var c=b;-1<window.location.href.indexOf(a)&&(c=this.getUrlVars(a)[a]);return"undefined"!==
typeof c?c:b},addCriteriaByURL:function(a){if(null!==this.urlParameters&&""!==this.urlParameters){var b=this.urlParameters[a.name];if("undefined"!==typeof b)if(this.config.simpleMode)if(0<b.length)b.forEach(g.hitch(this,function(a,b){d.emit(this.btnCriteria,"click",{bubbles:!0,cancelable:!0})})),d.emit(this.btnApply,"click",{bubbles:!0,cancelable:!0});else{var b=this.checkDefaultValue(a),c=this.checkDefaultOperator(a);this.createNewRow({operator:c,value:b,conjunc:"OR",state:"new",group:a.name})}else b.forEach(g.hitch(this,
function(a,b){d.emit(this.btnCriteria,"click",{bubbles:!0,cancelable:!0})})),0<b.length?d.emit(this.btnApply,"click",{bubbles:!0,cancelable:!0}):(b=this.checkDefaultValue(a),c=this.checkDefaultOperator(a),this.createNewRow({operator:c,value:b,conjunc:"OR",state:"new",group:a.name}));else b=this.checkDefaultValue(a),c=this.checkDefaultOperator(a),this.createNewRow({operator:c,value:b,conjunc:"OR",state:"new",group:a.name})}},_setFirstLastNodeOnMainScreen:function(){this._setWidgetFirstFocusNode(this.optionsIcon.focusNode,
this.btnReset);this.grpSelect.focus()},_setWidgetFirstFocusNode:function(a,b){p.initFirstFocusNode(this.domNode,a);p.initLastFocusNode(this.domNode,b)},_updateTabNodes:function(a){var b;"save"===a?(a=this.closeSaveIcon.focusNode,b=this.refreshDataIcon,this.closeSaveIcon.focus()):(a=this.optionsIcon.focusNode,b=this.btnReset,this.grpSelect.focus());this._setWidgetFirstFocusNode(a,b)},handleKeyDownEvents:function(){this.own(d(this.btnCriteria,"keydown",g.hitch(this,function(a){a.keyCode!==r.ENTER&&
a.keyCode!==r.SPACE||this.btnNewRowAction()})));this.own(d(this.btnApply,"keydown",g.hitch(this,function(a){a.keyCode!==r.ENTER&&a.keyCode!==r.SPACE||this.setFilterLayerDef()})));this.own(d(this.btnReset,"keydown",g.hitch(this,function(a){a.keyCode===r.ENTER||a.keyCode===r.SPACE?this.resetLayerDef(a):a.keyCode===r.TAB&&this.optionsIcon.focus()})));this.own(d(this.optionsIcon,"keydown",g.hitch(this,function(a){a.keyCode!==r.ENTER&&a.keyCode!==r.SPACE||this.toggleSaveFilter()})));this.own(d(this.closeSaveIcon,
"keydown",g.hitch(this,function(a){a.keyCode!==r.ENTER&&a.keyCode!==r.SPACE||this.toggleSaveFilter()})));this.own(d(this.refreshDataIcon,"keydown",g.hitch(this,function(a){a.keyCode===r.ENTER||a.keyCode===r.SPACE?this.refreshData():a.keyCode===r.TAB&&this.closeSaveIcon.focus()})));this.own(d(this.chkPersistDef,"keydown",g.hitch(this,function(a){if(a.keyCode===r.ENTER||a.keyCode===r.SPACE)this.chkPersistDef.get("checked")?this.chkPersistDef.set("checked",!1):this.chkPersistDef.set("checked",!0)})));
this.own(d(this.btnSaveToJson,"keydown",g.hitch(this,function(a){a.keyCode!==r.ENTER&&a.keyCode!==r.SPACE||this.saveJsonToFile()})))},registerEventHandler:function(){this.own(d(this.optionsIcon,"click",g.hitch(this,function(a){this.toggleSaveFilter()})));this.own(d(this.closeSaveIcon,"click",g.hitch(this,function(a){this.toggleSaveFilter()})))},onOpen:function(){this.firstOpen||(this.bypassActive=!0,this.onLayerUpdate())},onActive:function(){if(!this.firstOpen&&!this.bypassActive)this.onLayerUpdate()},
onDeActive:function(){this.bypassActive=!1},onClose:function(){this.chkPersistDef.checked||(this.resetLayerDef({group:this.grpSelect.value}),this.removeAllRows(),this.reconstructRows(this.grpSelect.value));this.bypassActive=this.firstOpen=!1},onMinimize:function(){},onMaximize:function(){},onSignIn:function(a){},onSignOut:function(){}})});